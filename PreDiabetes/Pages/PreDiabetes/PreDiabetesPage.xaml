<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:vm="clr-namespace:PreDiabetes.ViewModels;assembly=PreDiabetes"
    xmlns:conv="clr-namespace:PreDiabetes.Converters;assembly=PreDiabetes"
    xmlns:resx="clr-namespace:PreDiabetes.Resources.Languages"
    x:Class="PreDiabetes.Pages.PreDiabetesPage"
    x:DataType="vm:PreDiabetesViewModel"
    Title="PrÃ©-Diabetes"
    BackgroundColor="{StaticResource PageBackgroundColor}">

    <ContentPage.Resources>
        <conv:InverseBoolConverter x:Key="InverseBoolConverter" />
        <conv:BmiCategoryToBrushConverter x:Key="BmiCategoryToBrush" />

        <ResourceDictionary>
            <Color x:Key="Primary">#2B0B98</Color>
            <Color x:Key="MutedText">#6B6B6B</Color>
            <Color x:Key="CardBackground">#FFFFFF</Color>
            <Color x:Key="PageBackgroundColor">#F4F5FA</Color>
            <Color x:Key="BorderLight">#E6E7F0</Color>

            <Style x:Key="SectionCard" TargetType="Border">
                <Setter Property="Background" Value="{StaticResource CardBackground}" />
                <Setter Property="Stroke" Value="{StaticResource BorderLight}" />
                <Setter Property="StrokeThickness" Value="1" />
                <Setter Property="StrokeShape">
                    <Setter.Value>
                        <RoundRectangle CornerRadius="12" />
                    </Setter.Value>
                </Setter>
                <Setter Property="Padding" Value="2" />
                <Setter Property="Margin" Value="10,2" />
            </Style>

            <Style x:Key="SectionHeader" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource Primary}" />
            </Style>

            <Style x:Key="FieldLabel" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{StaticResource MutedText}" />
            </Style>

            <Style x:Key="PrimaryButton" TargetType="Button">
                <Setter Property="Background" Value="#28A745" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="CornerRadius" Value="10" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="HeightRequest" Value="44" />
                <Setter Property="HorizontalOptions" Value="Fill" />
                <Setter Property="Margin" Value="10,8" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="8">
            <Label Text="{resx:Localize Key=TituloSimulacao}" FontSize="18" FontAttributes="Bold" TextColor="{StaticResource Primary}" />

            <Border Style="{StaticResource SectionCard}">
                <VerticalStackLayout Spacing="8">
                    <Label Text="{resx:Localize Key=Simulacao_GrupoIdades}" Style="{StaticResource SectionHeader}" />
                    <Picker
                        SelectedIndex="{Binding AgeIndex, Mode=TwoWay}"
                        FontSize="16"
                        ItemsSource="{Binding AgeGroups}" />
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource SectionCard}">
                <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">
                    <VerticalStackLayout>
                        <Label Text="{resx:Localize Key=TituloSexo}" Style="{StaticResource SectionHeader}" />
                        <Picker
                            SelectedIndex="{Binding GenderIndex, Mode=TwoWay}"
                            FontSize="16"
                            ItemsSource="{Binding GenderOptions}" />
                    </VerticalStackLayout>

                    <!-- put the whole stack in column 1 (attached property must be on the direct child) -->
                    <VerticalStackLayout Margin="10, 0, 0, 10" Grid.Column="1" HorizontalOptions="End" VerticalOptions="Center" Spacing="6">
                        <Label Text="{resx:Localize Key=Simulacao_Fumador}" Style="{StaticResource SectionHeader}" HorizontalOptions="End" />
                        <Switch IsToggled="{Binding IsSmoker, Mode=TwoWay}" HorizontalOptions="End" />
                    </VerticalStackLayout>
                </Grid>
            </Border>

            <Border Style="{StaticResource SectionCard}">
                <VerticalStackLayout>
                    <Label Text="{resx:Localize Key=Simulacao_HitoricoExames_Titulo}" Style="{StaticResource SectionHeader}" />
                    <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto, Auto, Auto, Auto" >
                        <Label Text="{resx:Localize Key=Simulacao_Hipertensao}" Style="{StaticResource FieldLabel}" VerticalOptions="Center" />
                        <Switch Grid.Column="1" IsToggled="{Binding HipertensaoMedication, Mode=TwoWay}" HorizontalOptions="End" />

                        <Label Text="{resx:Localize Key=Simulacao_Glucose}" Style="{StaticResource FieldLabel}" Grid.Row="1" VerticalOptions="Center"  />
                        <Switch Grid.Column="1" IsToggled="{Binding GlucoseInTests, Mode=TwoWay}" Grid.Row="1" VerticalOptions="Center"  />

                        <Label Text="{resx:Localize Key=Simulacao_Parente}" Style="{StaticResource FieldLabel}" Grid.Row="2" VerticalOptions="Center"  />
                        <Switch Grid.Column="1" IsToggled="{Binding ParenteDiabetes, Mode=TwoWay}" Grid.Row="2" />

                        <Label Text="{resx:Localize Key=Simulacao_AtividadeFisica}" Style="{StaticResource FieldLabel}" Grid.Row="3" VerticalOptions="Center"  />
                        <Switch Grid.Column="1" IsToggled="{Binding AtividadeFisica, Mode=TwoWay}" Grid.Row="3" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource SectionCard}">
                <VerticalStackLayout>
                    <Label Text="{resx:Localize Key=Simulacao_Vegetais_Label}" Style="{StaticResource FieldLabel}" />
                    <VerticalStackLayout>
                        <RadioButton Content="{Binding VegetaisOptionYes}" IsChecked="{Binding VegetaisTodosOsDias, Mode=TwoWay}" GroupName="Veg" />
                        <RadioButton Content="{Binding VegetaisOptionNo}" IsChecked="{Binding VegetaisTodosOsDias, Mode=TwoWay, Converter={StaticResource InverseBoolConverter}}" GroupName="Veg" />
                    </VerticalStackLayout>
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource SectionCard}">
                <VerticalStackLayout>
                    <Label Text="{resx:Localize Key=Simulacao_Anca_Titulo}" Style="{StaticResource SectionHeader}" />
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <!-- Anca - Homens -->
                        <VerticalStackLayout IsVisible="{Binding ShowManWaist}">
                            <Label Text="{resx:Localize Key=TituloMasculinos}" Style="{StaticResource FieldLabel}" />
                            <Picker
                                SelectedIndex="{Binding ManWaistIndex, Mode=TwoWay}"
                                FontSize="16"
                                ItemsSource="{Binding ManWaistOptions}" />
                        </VerticalStackLayout>

                        <!-- Anca - Mulheres -->
                        <VerticalStackLayout IsVisible="{Binding ShowWomanWaist}">
                            <Label Text="{resx:Localize Key=TituloFemininos}" Style="{StaticResource FieldLabel}" />
                            <Picker
                                SelectedIndex="{Binding WomanWaistIndex, Mode=TwoWay}"
                                ItemsSource="{Binding WomanWaistOptions}" />
                        </VerticalStackLayout>
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <Border Style="{StaticResource SectionCard}">
                <VerticalStackLayout Spacing="6">
                    <Label Text="{resx:Localize Key=TituloPesoAltura}" Style="{StaticResource SectionHeader}" />
                    <Grid ColumnDefinitions="2*,2*,3*" ColumnSpacing="8">
                        <VerticalStackLayout HorizontalOptions="Fill">
                            <Label Text="{resx:Localize Key=TituloPeso}" Style="{StaticResource FieldLabel}" />
                            <Entry Text="{Binding WeightKgText}" Placeholder="Ex.: 75" Keyboard="Numeric" HorizontalOptions="Fill" FontSize="14" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="1" HorizontalOptions="Fill">
                            <Label Text="{resx:Localize Key=TituloAltura}" Style="{StaticResource FieldLabel}" />
                            <Entry Text="{Binding HeightCmText}" FontSize="14" Placeholder="Ex.: 175" Keyboard="Numeric" HorizontalOptions="Fill" />
                        </VerticalStackLayout>

                        <VerticalStackLayout Grid.Column="2" Margin="0,0,20,0" HorizontalOptions="End" IsVisible="{Binding IsBmiVisible}" VerticalOptions="Center">
                            <Label Text="{resx:Localize Key=TituloIMC}" Style="{StaticResource FieldLabel}" HorizontalOptions="End" />
                            <Label Text="{Binding BmiText}" FontSize="14" TextColor="{Binding BmiColor}" HorizontalOptions="End" />
                            <Label Text="{Binding BmiCategory}" FontSize="12" TextColor="{Binding BmiColor}" HorizontalOptions="End" />
                        </VerticalStackLayout>
                    </Grid>

                    <Label Text="{Binding ValidationMessage}"
                           TextColor="Crimson"
                           FontSize="12"
                           IsVisible="{Binding HasValidationMessage}" />
                </VerticalStackLayout>
            </Border>

            <Button Text="{resx:Localize Key=Btn_Calcular}"
                    Command="{Binding CalculateCommand}"
                    Style="{StaticResource PrimaryButton}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>